// 2D Football Game
// Uses SFML for graphics, input handling, and audio

#include <SFML/Graphics.hpp>
#include <SFML/Audio.hpp>
#include <iostream>
#include <vector>
#include <cmath>
#include <random>
#include <memory>
#include <algorithm>

// Game constants
const int WINDOW_WIDTH = 1024;
const int WINDOW_HEIGHT = 768;
const float PLAYER_SPEED = 200.0f;
const float BALL_MAX_SPEED = 400.0f;
const float BALL_FRICTION = 0.98f;
const float KICK_STRENGTH = 350.0f;
const float PLAYER_RADIUS = 20.0f;
const float BALL_RADIUS = 15.0f;
const float GOAL_WIDTH = 120.0f;
const float GOAL_HEIGHT = 300.0f;

// Forward declarations
class GameObject;
class Player;
class Ball;
class Team;
class Game;

// Vector utility functions
float length(const sf::Vector2f& v) {
    return std::sqrt(v.x * v.x + v.y * v.y);
    }

    sf::Vector2f normalize(const sf::Vector2f& v) {
        float l = length(v);
            if (l != 0)
                    return v / l;
                        return v;
                        }

                        float distance(const sf::Vector2f& a, const sf::Vector2f& b) {
                            return length(b - a);
                            }

                            // Base class for all game objects
                            class GameObject {
                            protected:
                                sf::Vector2f position;
                                    sf::Vector2f velocity;
                                        sf::CircleShape shape;

                                        public:
                                            GameObject(float radius, sf::Color color, sf::Vector2f pos = sf::Vector2f(0, 0)) 
                                                    : position(pos), velocity(sf::Vector2f(0, 0)) {
                                                            shape.setRadius(radius);
                                                                    shape.setFillColor(color);
                                                                            shape.setOrigin(radius, radius);
                                                                                    shape.setPosition(position);
                                                                                        }

                                                                                            virtual ~GameObject() = default;
                                                                                                
                                                                                                    virtual void update(float deltaTime) {
                                                                                                            position += velocity * deltaTime;
                                                                                                                    shape.setPosition(position);
                                                                                                                        }

                                                                                                                            virtual void draw(sf::RenderWindow& window) {
                                                                                                                                    window.draw(shape);
                                                                                                                                        }

                                                                                                                                            sf::Vector2f getPosition() const { return position; }
                                                                                                                                                sf::Vector2f getVelocity() const { return velocity; }
                                                                                                                                                    void setPosition(sf::Vector2f pos) { position = pos; shape.setPosition(pos); }
                                                                                                                                                        void setVelocity(sf::Vector2f vel) { velocity = vel; }
                                                                                                                                                            float getRadius() const { return shape.getRadius(); }

                                                                                                                                                                // Check collision with another game object
                                                                                                                                                                    bool collidesWith(GameObject* other) {
                                                                                                                                                                            float dist = distance(position, other->getPosition());
                                                                                                                                                                                    return dist < (shape.getRadius() + other->getRadius());
                                                                                                                                                                                        }
                                                                                                                                                                                        };




// Player class
class Player : public GameObject {
private:
    int team;
        bool isSelected;
            bool isAI;
                sf::CircleShape selectionIndicator;
                    
                    public:
                        Player(int teamId, sf::Vector2f pos, bool ai = false)
                                : GameObject(PLAYER_RADIUS, (teamId == 0) ? sf::Color(255, 0, 0, 200) : sf::Color(0, 0, 255, 200), pos),
                                          team(teamId), isSelected(false), isAI(ai) {
                                                  
                                                          // Create selection indicator
                                                                  selectionIndicator.setRadius(PLAYER_RADIUS + 5);
                                                                          selectionIndicator.setFillColor(sf::Color::Transparent);
                                                                                  selectionIndicator.setOutlineColor(sf::Color::Yellow);
                                                                                          selectionIndicator.setOutlineThickness(2);
                                                                                                  selectionIndicator.setOrigin(selectionIndicator.getRadius(), selectionIndicator.getRadius());
                                                                                                          selectionIndicator.setPosition(position);
                                                                                                              }

                                                                                                                  void update(float deltaTime) override {
                                                                                                                          // Add some friction/drag to slow down player
                                                                                                                                  velocity *= 0.95f;
                                                                                                                                          
                                                                                                                                                  // Call base class update
                                                                                                                                                          GameObject::update(deltaTime);
                                                                                                                                                                  
                                                                                                                                                                          // Keep player in bounds
                                                                                                                                                                                  keepInBounds();
                                                                                                                                                                                          
                                                                                                                                                                                                  // Update selection indicator position
                                                                                                                                                                                                          selectionIndicator.setPosition(position);
                                                                                                                                                                                                              }
                                                                                                                                                                                                                  
                                                                                                                                                                                                                      void draw(sf::RenderWindow& window) override {
                                                                                                                                                                                                                              // Draw selection indicator if player is selected
                                                                                                                                                                                                                                      if (isSelected) {
                                                                                                                                                                                                                                                  window.draw(selectionIndicator);
                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                          // Draw player
                                                                                                                                                                                                                                                                                  GameObject::draw(window);
                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                              void keepInBounds() {
                                                                                                                                                                                                                                                                                                      // Field boundaries with some margins
                                                                                                                                                                                                                                                                                                              const float MARGIN = 10.0f;
                                                                                                                                                                                                                                                                                                                      const float LEFT = MARGIN;
                                                                                                                                                                                                                                                                                                                              const float RIGHT = WINDOW_WIDTH - MARGIN;
                                                                                                                                                                                                                                                                                                                                      const float TOP = MARGIN;
                                                                                                                                                                                                                                                                                                                                              const float BOTTOM = WINDOW_HEIGHT - MARGIN;
                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                              if (position.x - PLAYER_RADIUS < LEFT) position.x = LEFT + PLAYER_RADIUS;
                                                                                                                                                                                                                                                                                                                                                                      if (position.x + PLAYER_RADIUS > RIGHT) position.x = RIGHT - PLAYER_RADIUS;
                                                                                                                                                                                                                                                                                                                                                                              if (position.y - PLAYER_RADIUS < TOP) position.y = TOP + PLAYER_RADIUS;
                                                                                                                                                                                                                                                                                                                                                                                      if (position.y + PLAYER_RADIUS > BOTTOM) position.y = BOTTOM - PLAYER_RADIUS;
                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                      shape.setPosition(position);
                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                  void moveTowards(sf::Vector2f target, float deltaTime) {
    void kickBall(Ball* ball, sf::Vector2f direction);  // Implemented after Ball class
        
            void setSelected(bool selected) { isSelected = selected; }
                bool getSelected() const { return isSelected; }
                    int getTeam() const { return team; }
                        bool isAIControlled() const { return isAI; }
                        };
                        
                        // Ball class
                        class Ball : public GameObject {
                        public:
                            Ball(sf::Vector2f pos = sf::Vector2f(WINDOW_WIDTH / 2, WINDOW_HEIGHT / 2))
                                    : GameObject(BALL_RADIUS, sf::Color::White, pos) {
                                            // Make the ball look like a football
                                                    shape.setFillColor(sf::Color(255, 255, 255));
                                                            shape.setOutlineColor(sf::Color(0, 0, 0));
                                                                    shape.setOutlineThickness(1);
                                                                        }
                                                                            
                                                                                void update(float deltaTime) override {
                                                                                        // Apply friction to slow down the ball
                                                                                                velocity *= BALL_FRICTION;
                                                                                                        
                                                                                                                // If ball is moving very slowly, stop it
                                                                                                                        if (length(velocity) < 5.0f) {
                                                                                                                                    velocity = sf::Vector2f(0, 0);
                                                                                                                                            }
                                                                                                                                                    
                                                                                                                                                            // Call base class update
                                                                                                                                                                    GameObject::update(deltaTime);
                                                                                                                                                                            
                                                                                                                                                                                    // Keep ball in bounds
                                                                                                                                                                                            keepInBounds();
                                                                                                                                                                                                }
                                                                                                                                                                                                    
                                                                                                                                                                                                        void keepInBounds() {
                                                                                                                                                                                                                const float LEFT = 0;
                                                                                                                                                                                                                        const float RIGHT = WINDOW_WIDTH;
                                                                                                                                                                                                                                const float TOP = 0;
                                                                                                                                                                                                                                        const float BOTTOM = WINDOW_HEIGHT;
                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                        bool collision = false;
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                        // Check if ball hits the boundaries and bounce
                                                                                                                                                                                                                                                                                if (position.x - BALL_RADIUS < LEFT) {
                                                                                                                                                                                                                                                                                            position.x = LEFT + BALL_RADIUS;
                                                                                                                                                                                                                                                                                                        velocity.x = -velocity.x * 0.8f;
                                                                                                                                                                                                                                                                                                                    collision = true;
                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                            if (position.x + BALL_RADIUS > RIGHT) {
                                                                                                                                                                                                                                                                                                                                                        position.x = RIGHT - BALL_RADIUS;
                                                                                                                                                                                                                                                                                                                                                                    velocity.x = -velocity.x * 0.8f;
                                                                                                                                                                                                                                                                                                                                                                                collision = true;
                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                        if (position.y - BALL_RADIUS < TOP) {
                                                                                                                                                                                                                                                                                                                                                                                                                    position.y = TOP + BALL_RADIUS;
                                                                                                                                                                                                                                                                                                                                                                                                                                velocity.y = -velocity.y * 0.8f;
                                                                                                                                                                                                                                                                                                                                                                                                                                            collision = true;
                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (position.y + BALL_RADIUS > BOTTOM) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                position.y = BOTTOM - BALL_RADIUS;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            velocity.y = -velocity.y * 0.8f;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        collision = true;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (collision) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Reduce speed slightly on collision
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        velocity *= 0.9f;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                shape.setPosition(position);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  // Now implement Player::kickBall since Ball class is defined
  void Player::kickBall(Ball* ball, sf::Vector2f direction) {
      // Normalize direction
          direction = normalize(direction);
              
                  // Apply kick force to ball
                      ball->setVelocity(direction * KICK_STRENGTH);
                      }
                      
                      // Team class to manage multiple players
                      class Team {
                      private:
                          std::vector<std::shared_ptr<Player>> players;
                              int teamId;
                                  sf::Vector2f initialPositions[5] = {
                                          {0, 0},  // Will be set in constructor based on team
                                                  {0, 0},
                                                          {0, 0},
                                                                  {0, 0},
                                                                          {0, 0}
                                                                              };
                                                                                  int selectedPlayerIndex;
                                                                                      
                                                                                      public:
                                                                                          Team(int id, bool aiControlled = false) : teamId(id), selectedPlayerIndex(0) {
                                                                                                  // Set initial positions based on team
                                                                                                          if (teamId == 0) {  // Left team (red)
                                                                                                                      initialPositions[0] = sf::Vector2f(100, WINDOW_HEIGHT / 2);  // Goalkeeper
                                                                                                                                  initialPositions[1] = sf::Vector2f(250, WINDOW_HEIGHT / 4);  // Defender
                                                                                                                                              initialPositions[2] = sf::Vector2f(250, 3 * WINDOW_HEIGHT / 4);  // Defender
                                                                                                                                                          initialPositions[3] = sf::Vector2f(400, WINDOW_HEIGHT / 3);  // Midfielder
                                                                                                                                                                      initialPositions[4] = sf::Vector2f(400, 2 * WINDOW_HEIGHT / 3);  // Forward
                                                                                                                                                                              } else {  // Right team (blue)
                                                                                                                                                                                          initialPositions[0] = sf::Vector2f(WINDOW_WIDTH - 100, WINDOW_HEIGHT / 2);  // Goalkeeper
                                                                                                                                                                                                      initialPositions[1] = sf::Vector2f(WINDOW_WIDTH - 250, WINDOW_HEIGHT / 4);  // Defender
                                                                                                                                                                                                                  initialPositions[2] = sf::Vector2f(WINDOW_WIDTH - 250, 3 * WINDOW_HEIGHT / 4);  // Defender
                                                                                                                                                                                                                              initialPositions[3] = sf::Vector2f(WINDOW_WIDTH - 400, WINDOW_HEIGHT / 3);  // Midfielder
                                                                                                                                                                                                                                          initialPositions[4] = sf::Vector2f(WINDOW_WIDTH - 400, 2 * WINDOW_HEIGHT / 3);  // Forward
                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                  // Create players
                                                                                                                                                                                                                                                                          for (int i = 0; i < 5; i++) {
                                                                                                                                                                                                                                                                                      players.push_back(std::make_shared<Player>(teamId, initialPositions[i], aiControlled));
                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                              // Select first player
                                                                                                                                                                                                                                                                                                                      if (!aiControlled) {
                                                                                                                                                                                                                                                                                                                                  players[selectedPlayerIndex]->setSelected(true);
                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                      void update(float deltaTime, Ball* ball) {
                                                                                                                                                                                                                                                                                                                                                              for (auto& player : players) {
                                                                                                                                                                                                                                                                                                                                                                          player->update(deltaTime);
                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                  // AI logic
                                                                                                                                                                                                                                                                                                                                                                                                          if (players[0]->isAIControlled()) {
                                                                                                                                                                                                                                                                                                                                                                                                                      simpleAI(ball);
                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                          void draw(sf::RenderWindow& window) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                  for (auto& player : players) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                              player->draw(window);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  void simpleAI(Ball* ball) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // Very simple AI: closest player chases ball, others maintain formation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  int closestPlayerIndex = 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          float minDistance = 9999.0f;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // Find closest player to the ball
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  for (size_t i = 0; i < players.size(); i++) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              float dist = distance(players[i]->getPosition(), ball->getPosition());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (dist < minDistance) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          minDistance = dist;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          closestPlayerIndex = i;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              // Move closest player towards ball
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      if (minDistance > PLAYER_RADIUS + BALL_RADIUS + 5.0f) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  players[closestPlayerIndex]->moveTowards(ball->getPosition(), 1.0f/60.0f);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      // If close enough, kick towards opponent's goal
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  sf::Vector2f kickDirection;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              if (teamId == 0) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              // Red team kicks towards right
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              kickDirection = sf::Vector2f(1, 0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // Blue team kicks towards left
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          kickDirection = sf::Vector2f(-1, 0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  players[closestPlayerIndex]->kickBall(ball, kickDirection);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          // Other players move back to their positions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  for (size_t i = 0; i < players.size(); i++) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              if (i != closestPlayerIndex) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              players[i]->moveTowards(initialPositions[i], 1.0f/60.0f);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              void switchSelectedPlayer() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      if (!players[0]->isAIControlled()) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  // Unselect current player
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              players[selectedPlayerIndex]->setSelected(false);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      // Select next player
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  selectedPlayerIndex = (selectedPlayerIndex + 1) % players.size();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              players[selectedPlayerIndex]->setSelected(true);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  void moveSelectedPlayer(sf::Vector2f direction, float deltaTime) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if (!players[0]->isAIControlled() && direction != sf::Vector2f(0, 0)) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      players[selectedPlayerIndex]->setVelocity(normalize(direction) * PLAYER_SPEED);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          std::shared_ptr<Player> getSelectedPlayer() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  return players[selectedPlayerIndex];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              void resetPositions() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      for (size_t i = 0; i < players.size(); i++) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  players[i]->setPosition(initialPositions[i]);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              players[i]->setVelocity(sf::Vector2f(0, 0));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  std::vector<std::shared_ptr<Player>> getPlayers() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          return players;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              };                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  sf::Vector2f direction = target - position;
                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                          // Only move if we're not already at the target
                                                                                                                                                                                                                                                                                                                                                                                                                                                  if (length(direction) > 5.0f) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                              sf::Vector2f normalizedDir = normalize(direction);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          velocity = normalizedDir * PLAYER_SPEED;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              velocity = sf::Vector2f(0, 0);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }


